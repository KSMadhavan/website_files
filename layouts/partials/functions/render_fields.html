{{$fields := $.fields}}
{{$scratch := $.scratch}}

<!--Load external CSS sheets-->
{{range $fields}}{{ range .css_sources }}{{if (not (in ($scratch.Get "external_url_loads") .url)) }}
<link rel="stylesheet" type="text/css" href="{{.url}}">
{{ $scratch.Add "external_url_loads" .url }}
{{end}}{{end}}{{end}}
<!--Load custom CSS-->
<style>
    {{range $fields}}
    {{partial "functions/css_style.html" (dict "name" .name "styles" .styles) | safeCSS}}
    {{end}}
</style>

<!--Load external JS-->
{{range $fields}}{{ range .js_sources }}{{if (not (in ($scratch.Get "external_url_loads") .url)) }}
<script type="text/javascript" src="{{.url}}"></script>
{{ $scratch.Add "external_url_loads" .url }}
{{end}}{{end}}{{end}}

<!--Load custom JS-->

{{range $fields}}{{ range .custom_js_partials }}
{{partial .partial_location . }}
{{end}}{{end}}

<!--Create the HTML-->

{{range $fields}}
    {{if not .has_parent}}
        {{printf "<%s " .type | htmlUnescape | safeHTML }} id="{{.name}}" class = "{{.class}}"{{if (isset . "tags")}}{{range .tags}}{{.field}} = {{.value}}{{end}}{{end}}>
            {{.content | markdownify}}
            {{if .has_children}}
                {{partial "functions/field_loop.html" (dict "fields" $fields "current_name" .name )}}
            {{end}}
        {{ printf "</%s" .type | htmlUnescape | safeHTML }}>
    {{end}}
{{end}}
